<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Opulent Voice Radio Interface</title>

	<!-- Font preloading -->
	<link rel="preload" href="/static/fonts/AtkinsonHyperlegibleNext-Regular.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/static/fonts/AtkinsonHyperlegibleNext-Bold.woff2" as="font" type="font/woff2" crossorigin>
    
	<!-- CSS Files -->
	<link rel="stylesheet" href="/static/css/typography.css">
	<link rel="stylesheet" href="/static/css/main.css">
	<link rel="stylesheet" href="/static/css/audio.css">
	<link rel="stylesheet" href="/static/css/responsive.css">
	
	<!-- Accessibility and SEO -->
	<meta name="description" content="Amateur Radio Digital Voice and Chat Interface">
	<meta name="theme-color" content="#1a1a2e">
	
	<!-- Skip link for keyboard users -->
	<a href="#main-content" class="skip-link">Skip to main content</a>
</head>
<body>
	<!-- Screen reader announcements -->
	<div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
	<div id="sr-status" aria-live="assertive" aria-atomic="true" class="sr-only"></div>
	
	<header role="banner" class="main-header">
		<div class="header-content">
			<h1 class="app-title">
				<span class="app-icon" aria-hidden="true">📻</span>
				Opulent Voice Radio
			</h1>
			
			<div class="connection-status" id="connection-status" role="status" aria-live="polite">
				<span class="status-indicator connecting" aria-label="Connection status"></span>
				<span class="status-text">Connecting...</span>
			</div>
			
			<div class="header-controls">
				<nav class="tab-navigation" role="tablist">
					<button class="tab-button active" 
							role="tab" 
							aria-selected="true" 
							aria-controls="chat-panel"
							id="chat-tab"
							onclick="switchTab('chat')">
						💬 Chat
					</button>
					<button class="tab-button" 
							role="tab" 
							aria-selected="false" 
							aria-controls="config-panel"
							id="config-tab"
							onclick="switchTab('config')">
						⚙️ Configuration
					</button>
				</nav>
			</div>
		</div>
	</header>

	<main id="main-content" role="main" class="main-container">
		
		<!-- Chat Panel (Default View) -->
		<div id="chat-panel" class="panel" role="tabpanel" aria-labelledby="chat-tab">
			<div class="panel-title">
				<span class="panel-icon">💬</span>
				Communications
			</div>
			
			<div class="chat-container">
				<div class="chat-header">
					<div class="station-info">
						<span>Station: </span>
						<strong id="current-station">CONNECTING...</strong>
					</div>
					
					<button id="ptt-button" 
							class="ptt-button" 
							aria-pressed="false"
							aria-describedby="ptt-status"
							disabled>
						<span aria-hidden="true">🎤</span>
						<span class="ptt-text">PTT</span>
					</button>
				</div>
				
				<div id="message-history" 
					 class="message-history" 
					 role="log" 
					 aria-live="polite" 
					 aria-label="Message history"
					 tabindex="0">
					<div class="message system">
						<div>Welcome to Opulent Voice Radio Interface</div>
						<div class="message-meta">
							<span>System</span>
							<span id="welcome-time"></span>
						</div>
					</div>
				</div>
				
				<!-- Connection retry panel (initially hidden) -->
				<div id="connection-retry" class="connection-retry" style="display: none;">
					<div>Connection lost to radio system</div>
					<button class="retry-button" onclick="attemptReconnect()">Retry Connection</button>
				</div>
				
				<form id="message-form" class="message-input-form">
					<div class="input-container">
						<label for="message-input" class="sr-only">Message to send</label>
						<textarea id="message-input"
							class="message-input"
							placeholder="Type your message..."
							rows="1"
							disabled></textarea>
					</div>
					<button type="submit"
						class="send-button"
						disabled>
						Send
					</button>
				</form>				
			</div>
		</div>

		<!-- Configuration Panel -->
		<div id="config-panel" class="config-tabs" role="tabpanel" aria-labelledby="config-tab">
			<div class="panel-title">
				<span class="panel-icon">⚙️</span>
				Configuration Management
			</div>
			
			<!-- Configuration Management Section -->
			<div class="config-section config-management-consolidated">
				<div class="section-header">
					<span aria-hidden="true">📋</span>
					Configuration Management
				</div>
				
				<!-- Current Configuration Status -->
				<div class="config-status-display">
					<div class="current-file-status">
						<div class="status-item">
							<label class="status-label">📄 Active Configuration File:</label>
							<span id="current-config-file" class="status-value">No file loaded</span>
						</div>
					</div>
				</div>
				
				<!-- File Operations Section -->
				<div class="config-file-operations">
					<h4 class="operation-group-title">📂 File Operations</h4>
					
					<!-- Load Configuration -->
					<div class="operation-group">
						<label class="operation-label">Load Configuration</label>
						<div class="operation-controls">
							<div class="input-group">
								<input type="text" 
									   id="load-config-filename" 
									   placeholder="Leave empty for auto-discovery"
									   class="config-filename-input"
									   aria-label="Configuration file to load">
								<button class="btn btn-primary operation-btn" onclick="loadConfigFile()">
									<span aria-hidden="true">📂</span>
									Load
								</button>
							</div>
							<div class="operation-help">
								Auto-discovery searches: opulent_voice.yaml → config/opulent_voice.yaml → ~/.config/opulent_voice/config.yaml
							</div>
						</div>
					</div>
					
					<!-- Save Configuration -->
					<div class="operation-group">
						<label class="operation-label">Save Configuration</label>
						<div class="operation-controls">
							<div class="input-group">
								<input type="text" 
									   id="save-config-filename" 
									   placeholder="Leave empty to save to original file"
									   class="config-filename-input"
									   aria-label="Configuration file to save to">
								<button class="btn btn-success operation-btn" onclick="saveConfigFile()">
									<span aria-hidden="true">💾</span>
									Save
								</button>
							</div>
							<div class="operation-help">
								Saves current form settings to file. Empty filename saves to original loaded file.
							</div>
						</div>
					</div>
					
					<!-- Create Template Configuration -->
					<div class="operation-group">
						<label class="operation-label">Create Template Configuration</label>
						<div class="operation-controls">
							<div class="input-group">
								<input type="text" 
									   id="create-config-filename" 
									   placeholder="opulent-voice.yaml"
									   class="config-filename-input"
									   aria-label="Template configuration filename">
								<button class="btn operation-btn" onclick="createConfigFileEnhanced()">
									<span aria-hidden="true">📄</span>
									Create Template
								</button>
							</div>
							<div class="operation-help">
								Creates a sample configuration with comments and examples
							</div>
						</div>
					</div>
				</div>
				
				<!-- Configuration Actions Section -->
				<div class="config-actions-section">
					<h4 class="operation-group-title">⚙️ Configuration Actions</h4>
					
					<div class="action-buttons-grid">
						<!-- Apply to System -->
						<div class="action-group">
							<button class="btn btn-primary action-btn" onclick="applyConfig()">
								<span aria-hidden="true">✅</span>
								<div class="btn-content">
									<div class="btn-title">Apply Changes</div>
									<div class="btn-subtitle">Update running system</div>
								</div>
							</button>
							<div class="action-help">
								Applies current form settings to the running radio system (does not save to file)
							</div>
						</div>
						
						<!-- Test System -->
						<div class="action-group">
							<button class="btn action-btn" onclick="testConnection()">
								<span aria-hidden="true">🧪</span>
								<div class="btn-content">
									<div class="btn-title">Test System</div>
									<div class="btn-subtitle">Validate configuration</div>
								</div>
							</button>
							<div class="action-help">
								Tests network, audio, GPIO, and validates current form settings
							</div>
						</div>
						
						<!-- Reset Form -->
						<div class="action-group">
							<button class="btn action-btn" onclick="resetToDefaults()">
								<span aria-hidden="true">🔄</span>
								<div class="btn-content">
									<div class="btn-title">Reset Form</div>
									<div class="btn-subtitle">Restore defaults</div>
								</div>
							</button>
							<div class="action-help">
								Resets all form fields to default values (does not affect saved files)
							</div>
						</div>
					</div>
				</div>
				
				<!-- Status and Feedback Section -->
				<div class="config-feedback-section">
					<h4 class="operation-group-title">📊 Status</h4>
					<div class="config-status-container">
						<div id="config-status" class="config-status-message">
							Ready to manage configuration files and settings
						</div>
						<div id="config-operation-progress" class="operation-progress" style="display: none;">
							<div class="progress-spinner"></div>
							<span class="progress-text">Processing...</span>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Configuration Form Sections -->
			<div class="config-grid">
				<!-- Station Configuration -->
				<div class="config-section">
					<div class="section-header">
						<span aria-hidden="true">📡</span>
						Station Settings
					</div>
					
					<div class="form-group">
						<label for="callsign">Callsign *</label>
						<input type="text" 
							   id="callsign" 
							   placeholder="N0CALL" 
							   maxlength="10" 
							   required
							   aria-describedby="callsign-help">
						<div id="callsign-help" class="help-text">
							Amateur radio callsign (A-Z, 0-9, -, /, .)
						</div>
					</div>
				</div>

				<!-- Network Configuration -->
				<div class="config-section">
					<div class="section-header">
						<span aria-hidden="true">🌐</span>
						Network Settings
					</div>
					
					<div class="form-group">
						<label for="target-ip">Target IP Address</label>
						<input type="text" 
							   id="target-ip" 
							   placeholder="192.168.2.152"
							   aria-describedby="target-ip-help">
						<div id="target-ip-help" class="help-text">
							IP address of target system
						</div>
					</div>
					
					<div class="form-group">
						<label for="target-port">Target Port</label>
						<input type="number" 
							   id="target-port" 
							   placeholder="57372" 
							   min="1" 
							   max="65535"
							   aria-describedby="target-port-help">
						<div id="target-port-help" class="help-text">
							UDP port for radio communication
						</div>
					</div>
					
					<div class="form-group">
						<label for="listen-port">Listen Port</label>
						<input type="number" 
							   id="listen-port" 
							   placeholder="57372" 
							   min="1" 
							   max="65535"
							   aria-describedby="listen-port-help">
						<div id="listen-port-help" class="help-text">
							Local port for receiving messages
						</div>
					</div>
				</div>




<!-- Transcription Configuration -->
<div class="config-section">
    <div class="section-header">
        <span aria-hidden="true">🗨️</span>
        Transcription Settings
    </div>
    
    <!-- Essential Controls Only -->
    <div class="checkbox-group">
        <input type="checkbox" id="transcription-enabled">
        <label for="transcription-enabled">Enable Audio Transcription</label>
        <div class="help-text">
            Convert received voice messages to text automatically
        </div>
    </div>
    
    <div class="form-group">
        <label for="transcription-confidence">Confidence Threshold</label>
        <input type="range" 
               id="transcription-confidence" 
               min="0.3" 
               max="0.95" 
               step="0.05" 
               value="0.7"
               aria-describedby="confidence-help">
        <div id="confidence-help" class="help-text">
            Minimum confidence level to display transcriptions
        </div>
        <div class="range-value">
            <span id="confidence-value">70%</span>
        </div>
    </div>
    
    <!-- Advanced Settings (Read-only display) -->
    <div class="advanced-settings">
        <h4>Advanced Settings</h4>
        <div class="setting-display">
            <span class="setting-label">Language:</span>
            <span class="setting-value">Auto-detect</span>
        </div>
        <div class="setting-display">
            <span class="setting-label">Model Size:</span>
            <span class="setting-value">Base (290MB, balanced speed/accuracy)</span>
        </div>
        <div class="help-text">
            💡 <strong>For advanced users:</strong> Edit the YAML config file to change language or model size:
        </div>
        <div class="code-example">
            <code>
gui:<br>
&nbsp;&nbsp;transcription:<br>
&nbsp;&nbsp;&nbsp;&nbsp;language: "en"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# or "es", "fr", "auto"<br>
&nbsp;&nbsp;&nbsp;&nbsp;model_size: "large"&nbsp;&nbsp;&nbsp;&nbsp;# tiny, base, small, medium, large
            </code>
        </div>
        <div class="help-text">
            ⚠️ <strong>Model sizes:</strong> tiny (39MB), base (290MB), small (461MB), medium (1.5GB), large (2.9GB)<br>
            First use will download the model automatically.
        </div>
    </div>
</div>


<!-- Text-to-Speech Configuration -->
<div class="config-section">
    <div class="section-header">
        <span aria-hidden="true">🔊</span>
        Text-to-Speech Settings
    </div>
    
    <div class="checkbox-group">
        <input type="checkbox" id="tts-enabled">
        <label for="tts-enabled">Enable Text-to-Speech</label>
        <div class="help-text">
            Read text messages aloud using synthesized speech
        </div>
    </div>
    
    <div class="form-group">
        <h4>📥 Incoming Messages</h4>
        <div class="checkbox-group">
            <input type="checkbox" id="tts-incoming" checked>
            <label for="tts-incoming">Read incoming messages</label>
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="include-station-id" checked>
            <label for="include-station-id">Include Station ID</label>
        </div>
    </div>
    
    <div class="form-group">
        <h4>📤 Outgoing Messages</h4>
        <div class="checkbox-group">
            <input type="checkbox" id="tts-outgoing">
            <label for="tts-outgoing">Read my outgoing messages</label>
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="include-confirmation" checked>
            <label for="include-confirmation">Include "Message sent:" prefix</label>
        </div>
    </div>
    
<div class="form-group">
    <label for="speech-rate">Speech Rate</label>
    <input type="range" id="speech-rate" min="100" max="300" value="200">
    <div class="range-value">
        <span id="speech-rate-label">200 WPM</span>  <!-- Changed from rate-value -->
    </div>
</div>
<div class="form-group">
    <button id="test-tts-button" class="btn">🎵 Test TTS</button>  <!-- Changed from test-tts -->
</div>





				<!-- Target Device Type Configuration -->
				<div class="config-section">
					<div class="section-header">
						<span aria-hidden="true">🔧</span>
						Target Device Type Settings
					</div>
					
					<div class="form-group">
						<label for="target-type">Target Type</label>
						<select id="target-type" aria-describedby="target-type-help">
							<option value="computer">Computer (LAN/Internet)</option>
							<option value="modem">Modem (SDR/Radio)</option>
						</select>
						<div id="target-type-help" class="help-text">
							Affects keepalive and timeout behavior
						</div>
					</div>
					
					<div class="form-group">
						<label for="keepalive-interval">Keepalive Interval (seconds)</label>
						<input type="number" 
							   id="keepalive-interval" 
							   placeholder="2.0" 
							   min="0.5" 
							   max="60"
							   step="0.1"
							   aria-describedby="keepalive-help">
						<div id="keepalive-help" class="help-text">
							Keepalive timing for computer targets
						</div>
					</div>
				</div>

				<!-- GPIO Configuration -->
				<div class="config-section">
					<div class="section-header">
						<span aria-hidden="true">🔌</span>
						GPIO Settings (Raspberry Pi)
					</div>
					
					<div class="form-group">
						<label for="ptt-pin">PTT GPIO Pin</label>
						<input type="number" 
							   id="ptt-pin" 
							   placeholder="23" 
							   min="2" 
							   max="27"
							   aria-describedby="ptt-pin-help">
						<div id="ptt-pin-help" class="help-text">
							GPIO pin for PTT button
						</div>
					</div>
					
					<div class="form-group">
						<label for="led-pin">LED GPIO Pin</label>
						<input type="number" 
							   id="led-pin" 
							   placeholder="17" 
							   min="2" 
							   max="27"
							   aria-describedby="led-pin-help">
						<div id="led-pin-help" class="help-text">
							GPIO pin for PTT LED indicator
						</div>
					</div>
				</div>

				<!-- Debug Configuration -->
				<div class="config-section">
					<div class="section-header">
						<span aria-hidden="true">🐛</span>
						Debug Settings
					</div>
					
					<div class="checkbox-group">
						<input type="checkbox" id="verbose-mode">
						<label for="verbose-mode">Verbose Debug Output</label>
					</div>
					
					<div class="checkbox-group">
						<input type="checkbox" id="quiet-mode">
						<label for="quiet-mode">Quiet Mode (Minimal Output)</label>
					</div>
					
					<div class="form-group">
						<label for="log-level-config">Log Level</label>
						<select id="log-level-config">
							<option value="DEBUG">Debug (All Messages)</option>
							<option value="INFO" selected>Info (Normal)</option>
							<option value="WARNING">Warning (Important Only)</option>
							<option value="ERROR">Error (Problems Only)</option>
						</select>
					</div>
				</div>
			</div>
		</div>

		<!-- Status Panel (Always Visible) -->
		<div class="panel">
			<div class="panel-title">
				<span class="panel-icon">📊</span>
				System Status
			</div>
			
			<div class="status-grid">
				<div class="stat-item">
					<span class="stat-label">Connection</span>
					<span id="connection-stat" class="stat-value">CONNECTING</span>
				</div>
				
				<div class="stat-item">
					<span class="stat-label">Text Messages Sent</span>
					<span id="messages-sent" class="stat-value">0</span>
				</div>
				
				<div class="stat-item">
					<span class="stat-label">Text Messages Received</span>
					<span id="messages-received" class="stat-value">0</span>
				</div>
				
				<div class="stat-item">
					<span class="stat-label">Uptime</span>
					<span id="uptime" class="stat-value">00:00</span>
				</div>
			</div>
			
			<!-- System Log -->
			<div class="log-section">
				<h3>System Log</h3>
				<div class="log-controls">
					<select id="log-level" aria-label="Log level filter">
						<option value="all">All Messages</option>
						<option value="info">Info and Above</option>
						<option value="warning">Warnings and Errors</option>
						<option value="error">Errors Only</option>
					</select>
					
					<button class="btn" onclick="clearLog()">
						Clear Log
					</button>
				</div>
				
				<div id="system-log" 
					 class="system-log" 
					 role="log" 
					 aria-live="polite"
					 aria-label="System log messages"
					 tabindex="0">
				</div>
			</div>
		</div>
	</main>

	<!-- Notification system -->
	<div id="notification" class="notification"></div>

	<!-- JavaScript Files -->
	<script src="/static/js/typography.js"></script>
	<script src="/static/js/websocket.js"></script>
	<script src="/static/js/app.js"></script>
	<script src="/static/js/audio.js"></script>
	<script src="/static/js/config.js"></script>
</body>
</html>
